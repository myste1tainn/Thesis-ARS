!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@angular/core"),require("@angular/http"),require("@angular/common")):"function"==typeof define&&define.amd?define(["@angular/core","@angular/http","@angular/common"],t):(e.angular2=e.angular2||{},e.angular2.dynamic=e.angular2.dynamic||{},e.angular2.dynamic.component=t(e.ng.core,e.ng.http,e.ng.common))}(this,function(e,t,n){"use strict";function o(e,t){return t={exports:{}},e(t,t.exports),t.exports}e="default"in e?e.default:e,t="default"in t?t.default:t,n="default"in n?n.default:n;var r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a=(o(function(e,t){function n(e){var n=function(n){return function(o,r){var a=Reflect.getOwnMetadata(t.PROP_METADATA,o.constructor)||{};a[r]=a[r]||[],a[r].push(Reflect.construct(e,[n])),Reflect.defineMetadata(t.PROP_METADATA,a,o.constructor)}},o=n;return o.annotationMetadata=e,o}t.PROP_METADATA="propMetadata",t.ANNOTATIONS_METADATA="annotations",t.PropertyAnnotationFactory=n}),function(){function e(){}return e.isPresent=function(e){return void 0!==e&&null!==e},e.isUndefined=function(e){return void 0===e},e.isString=function(e){return"string"==typeof e},e.isFunction=function(e){return"function"==typeof e},e.isArray=function(e){return Array.isArray(e)},e}()),c=a,i={Utils:c},p=o(function(e,t){function n(e){var n=function(n){return function(o,r){var a=Reflect.getOwnMetadata(t.PROP_METADATA,o.constructor)||{};a[r]=a[r]||[],a[r].push(Reflect.construct(e,[n])),Reflect.defineMetadata(t.PROP_METADATA,a,o.constructor)}},o=n;return o.annotationMetadata=e,o}t.PROP_METADATA="propMetadata",t.ANNOTATIONS_METADATA="annotations",t.PropertyAnnotationFactory=n}),s=i,u=p,l=function(){function e(){}return e.findAnnotationsMetaData=function(t,n){return e.findMetadata(t,n,u.ANNOTATIONS_METADATA)},e.findPropertyMetadata=function(t,n){return e.findMetadata(t,n,u.PROP_METADATA)},e.findMetadata=function(e,t,n){var o=e.constructor===Function,r=Reflect.getMetadata(n,o?e:e.constructor);if(o)return r||[];var a,c={};return s.Utils.isPresent(r)&&Reflect.ownKeys(r).forEach(function(e){var n=function(e){var n=t.annotationMetadata;return e instanceof t||s.Utils.isPresent(n)&&e instanceof n};(a=r[e].find(n))&&Reflect.set(c,e,a)}),c},e}(),m=l,y={MetadataHelper:m},f=y,d=f.MetadataHelper,h=p,C=h.PropertyAnnotationFactory,P={MetadataHelper:d,PropertyAnnotationFactory:C},T=o(function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=e,r=P,a=0,c=function(){function e(){}return e.nextId=function(){return a++},e.buildByNextId=function(e){return e.replace("{id}",String(this.nextId()))},e.isPresent=function(e){return void 0!==e&&null!==e},e.isUndefined=function(e){return void 0===e},e.isString=function(e){return"string"==typeof e},e.isFunction=function(e){return"function"==typeof e},e.isArray=function(e){return Array.isArray(e)},e.findComponentDecoratorByComponentType=function(t){if(e.isPresent(t)){var n=r.MetadataHelper.findAnnotationsMetaData(t,o.Component);if(n.length)return n[0]}return null},e.isSelectorOfComponentTypeEqual=function(t,n){var o=e.findComponentDecoratorByComponentType(n),r=null;return this.isPresent(o)&&this.isPresent(r=this.extractSelector(o))&&t===r},e.extractSelector=function(e){return Reflect.get(e,"selector")},e.getParamTypes=function(e){return Reflect.getMetadata("design:paramtypes",e)},e.isSelectorPresent=function(t){return e.isPresent(this.extractSelector(t))},e.hashFnv32a=function(e,t,n){var o,r,a=void 0===n?2166136261:n;for(o=0,r=e.length;o<r;o++)a^=e.charCodeAt(o),a+=(a<<1)+(a<<4)+(a<<7)+(a<<8)+(a<<24);return t?("0000000"+(a>>>0).toString(16)).substr(-8):a>>>0},e}();n.Utils=c}),v=o(function(t,o){var a=r&&r.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(o,"__esModule",{value:!0});var c=e,i=n,p=P,s=T;o.DYNAMIC_TYPES={DynamicExtraModules:"DynamicExtraModules"};var u=function(){function e(e,t,n,o,r,a){this.dynamicExtraModules=e,this.viewContainer=t,this.compiler=n,this.http=o,this.dynamicCache=r,this.dynamicComponentReady=new c.EventEmitter(!1),this.dynamicComponentBeforeReady=new c.EventEmitter(!1),this.dynamicSelector=s.Utils.buildByNextId(a),this.injector=c.ReflectiveInjector.fromResolvedProviders([],this.viewContainer.parentInjector)}return e.prototype.ngOnChanges=function(e){var t=this;this.ngOnDestroy(),this.dynamicComponentBeforeReady.emit(null),this.buildModule().then(function(e){var n,o=Reflect.get(e,"__hashValue");s.Utils.isPresent(o)?(n=t.dynamicCache.get(o),s.Utils.isPresent(n)||t.dynamicCache.set(o,n=t.compiler.compileModuleAndAllComponentsAsync(e))):n=t.compiler.compileModuleAndAllComponentsAsync(e),n.then(function(e){t.moduleInstance=e.ngModuleFactory.create(t.injector);var n=e.componentFactories.find(function(e){return s.Utils.isSelectorOfComponentTypeEqual(e.selector,t.componentType)||e.selector===t.dynamicSelector||s.Utils.isPresent(e.componentType)&&s.Utils.isPresent(t.componentTemplate)&&Reflect.get(e.componentType,"__hashValue")===s.Utils.hashFnv32a(t.componentTemplate,!0)}),o=t.componentInstance=n.create(t.injector,null,null,t.moduleInstance);t.viewContainer.insert(o.hostView,0),t.applyPropertiesToDynamicComponent(t.componentInstance.instance),t.dynamicComponentReady.emit(t.componentInstance.instance)})})},e.prototype.ngOnDestroy=function(){s.Utils.isPresent(this.moduleInstance)&&(this.moduleInstance.destroy(),this.moduleInstance=null),s.Utils.isPresent(this.componentInstance)&&(this.componentInstance.destroy(),this.componentInstance=null),s.Utils.isPresent(this.cachedDynamicModule)&&(this.compiler.clearCacheFor(this.cachedDynamicModule),this.cachedDynamicModule=null),s.Utils.isPresent(this.cachedDynamicComponent)&&(this.compiler.clearCacheFor(this.cachedDynamicComponent),this.cachedDynamicComponent=null)},e.prototype.buildModule=function(){var e=this;return new Promise(function(t){s.Utils.isPresent(e.componentTemplate)?t(e.makeComponentModule({template:e.componentTemplate})):s.Utils.isPresent(e.componentTemplatePath)?t(e.makeComponentModule({templatePath:e.componentTemplatePath})):s.Utils.isPresent(e.componentTemplateUrl)?e.loadRemoteTemplate(e.componentTemplateUrl,t):t(e.makeComponentModule())})},e.prototype.loadRemoteTemplate=function(e,t){var n=this,o={withCredentials:!0};s.Utils.isPresent(this.componentRemoteTemplateFactory)&&(o=this.componentRemoteTemplateFactory.buildRequestOptions()),this.http.get(e,o).subscribe(function(e){if([301,302,307,308].indexOf(e.status)>-1){var o=e.headers.get("Location");console.debug("[$DynamicBase][loadRemoteTemplate] The URL into the chain is:",o),s.Utils.isPresent(o)?n.loadRemoteTemplate(o,t):console.warn("[$DynamicBase][loadRemoteTemplate] The URL into the chain is empty. The process of redirect has stopped.")}else{var r=s.Utils.isPresent(n.componentRemoteTemplateFactory)?n.componentRemoteTemplateFactory.parseResponse(e):e.text();t(n.makeComponentModule({template:r}))}},function(e){console.warn("[$DynamicBase][loadRemoteTemplate] Error response:",e);var o=n.componentDefaultTemplate||"";t(n.makeComponentModule({template:o}))})},e.prototype.makeComponentModule=function(e){var t=this.cachedDynamicComponent=this.makeComponent(e),n=this.dynamicExtraModules.concat(this.componentModules||[]),o=function(){function e(){}return e}();o.decorators=[{type:c.NgModule,args:[{declarations:[t],imports:[i.CommonModule].concat(n)}]}],o.ctorParameters=function(){return[]};var r=Reflect.get(t,"__hashValue");return s.Utils.isPresent(r)&&Reflect.set(o,"__hashValue",r),this.cachedDynamicModule=o},e.prototype.makeComponent=function(e){var t,n=this.injector,o=s.Utils.findComponentDecoratorByComponentType(this.componentType),r=s.Utils.isPresent(this.componentType)?s.Utils.getParamTypes(this.componentType)||[]:[];s.Utils.isPresent(o)?s.Utils.isSelectorPresent(o)||Reflect.set(o,"selector",this.componentType.name):(t={selector:this.dynamicSelector,styles:this.componentStyles},s.Utils.isPresent(e)&&(s.Utils.isPresent(e.template)?t.template=e.template:s.Utils.isPresent(e.templatePath)&&(t.templateUrl=e.templatePath)));var i=o||t,p=this.componentType||function(){function e(){}return e}(),u=function(e){function t(t){return e.apply(this,r.map(function(e){return t instanceof e?t:n.get(e)}).concat([t]))||this}return a(t,e),t}(p);return u.decorators=[{type:c.Component,args:[i]}],u.ctorParameters=function(){return[{type:c.ElementRef,decorators:[{type:c.Inject,args:[c.ElementRef]}]}]},s.Utils.isPresent(Reflect.get(i,"template"))&&Reflect.set(u,"__hashValue",s.Utils.hashFnv32a(Reflect.get(i,"template"),!0)),u},e.prototype.applyPropertiesToDynamicComponent=function(e){for(var t=this,n=p.MetadataHelper.findPropertyMetadata(this,c.Input),o=0,r=Object.keys(this);o<r.length;o++){var a=r[o];Reflect.has(n,a)&&(Reflect.has(e,a)&&console.warn("[$DynamicBase][applyPropertiesToDynamicComponent] The property",a,"will be overwritten for the component",e),Reflect.set(e,a,Reflect.get(this,a)))}if(s.Utils.isPresent(this.componentContext)){var i=this;for(var a in this.componentContext)!function(n){Reflect.has(e,n)&&console.warn("[$DynamicBase][applyPropertiesToDynamicComponent] The property",n,"will be overwritten for the component",e);var o=Reflect.get(i.componentContext,n),r={};s.Utils.isFunction(o)||(r.set=function(e){return Reflect.set(t.componentContext,n,e)}),r.get=function(){return Reflect.get(t.componentContext,n)},Reflect.defineProperty(e,n,r)}(a)}},e}();u.propDecorators={dynamicComponentReady:[{type:c.Output}],dynamicComponentBeforeReady:[{type:c.Output}],componentType:[{type:c.Input}],componentTemplate:[{type:c.Input}],componentStyles:[{type:c.Input}],componentContext:[{type:c.Input}],componentTemplateUrl:[{type:c.Input}],componentTemplatePath:[{type:c.Input}],componentDefaultTemplate:[{type:c.Input}],componentRemoteTemplateFactory:[{type:c.Input}],componentModules:[{type:c.Input}]},o.DynamicBase=u}),D=o(function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=e,r=function(){function e(e){var t=this;this.memoryCache=new Map,e.onUnstable.subscribe(function(){return t.memoryCache.clear()}),e.onStable.subscribe(function(){return t.memoryCache.clear()})}return e.prototype.set=function(e,t){this.memoryCache.set(e,t)},e.prototype.get=function(e){return this.memoryCache.get(e)},e}();r.decorators=[{type:o.Injectable}],r.ctorParameters=function(){return[{type:o.NgZone,decorators:[{type:o.Inject,args:[o.NgZone]}]}]},n.DynamicCache=r}),M=o(function(n,o){var a=r&&r.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(o,"__esModule",{value:!0});var c=e,i=t,p=v,s=D,u=function(){function e(e,t){void 0===e&&(e="DynamicComponent"),void 0===t&&(t=""),this.selector=e,this.template=t}return e}();o.DynamicComponentMetadata=u;var l=function(e){function t(t,n,o,r,a){return e.call(this,t,n,o,r,a,"DynamicComponent{id}")||this}return a(t,e),t}(p.DynamicBase);l.decorators=[{type:c.Component,args:[{selector:"DynamicComponent",template:""}]}],l.ctorParameters=function(){return[{type:Array,decorators:[{type:c.Inject,args:[p.DYNAMIC_TYPES.DynamicExtraModules]}]},{type:c.ViewContainerRef,decorators:[{type:c.Inject,args:[c.ViewContainerRef]}]},{type:c.Compiler,decorators:[{type:c.Inject,args:[c.Compiler]}]},{type:i.Http,decorators:[{type:c.Inject,args:[i.Http]}]},{type:s.DynamicCache,decorators:[{type:c.Inject,args:[s.DynamicCache]}]}]},l.propDecorators={dynamicComponentReady:[{type:c.Output}],dynamicComponentBeforeReady:[{type:c.Output}],componentType:[{type:c.Input}],componentTemplate:[{type:c.Input}],componentStyles:[{type:c.Input}],componentContext:[{type:c.Input}],componentTemplateUrl:[{type:c.Input}],componentTemplatePath:[{type:c.Input}],componentDefaultTemplate:[{type:c.Input}],componentRemoteTemplateFactory:[{type:c.Input}],componentModules:[{type:c.Input}]},o.DynamicComponent=l}),g=o(function(n,o){var a=r&&r.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(o,"__esModule",{value:!0});var c=e,i=t,p=v,s=D,u=function(e){function t(t,n,o,r,a){return e.call(this,t,n,o,r,a,"[dynamic-component-{id}]")||this}return a(t,e),t}(p.DynamicBase);u.decorators=[{type:c.Directive,args:[{selector:"[dynamic-component]"}]}],u.ctorParameters=function(){return[{type:Array,decorators:[{type:c.Inject,args:[p.DYNAMIC_TYPES.DynamicExtraModules]}]},{type:c.ViewContainerRef,decorators:[{type:c.Inject,args:[c.ViewContainerRef]}]},{type:c.Compiler,decorators:[{type:c.Inject,args:[c.Compiler]}]},{type:i.Http,decorators:[{type:c.Inject,args:[i.Http]}]},{type:s.DynamicCache,decorators:[{type:c.Inject,args:[s.DynamicCache]}]}]},u.propDecorators={dynamicComponentReady:[{type:c.Output}],dynamicComponentBeforeReady:[{type:c.Output}],componentType:[{type:c.Input}],componentTemplate:[{type:c.Input}],componentStyles:[{type:c.Input}],componentContext:[{type:c.Input}],componentTemplateUrl:[{type:c.Input}],componentTemplatePath:[{type:c.Input}],componentDefaultTemplate:[{type:c.Input}],componentRemoteTemplateFactory:[{type:c.Input}],componentModules:[{type:c.Input}]},o.DynamicDirective=u}),_=o(function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=e,r=M,a=g,c=v,i=D,p=function(){function e(){}return e}();p.decorators=[{type:o.NgModule,args:[{providers:[i.DynamicCache,{provide:c.DYNAMIC_TYPES.DynamicExtraModules,useValue:[]}],declarations:[r.DynamicComponent,a.DynamicDirective],exports:[r.DynamicComponent,a.DynamicDirective]}]}],p.ctorParameters=function(){return[]},n.DynamicComponentModule=p;var s=function(){function e(){}return e.buildModule=function(e){var t=function(){function e(){}return e}();return t.decorators=[{type:o.NgModule,args:[{providers:[i.DynamicCache,{provide:c.DYNAMIC_TYPES.DynamicExtraModules,useValue:e}],declarations:[r.DynamicComponent,a.DynamicDirective],exports:[r.DynamicComponent,a.DynamicDirective]}]}],t.ctorParameters=function(){return[]},t},e}();n.DynamicComponentModuleFactory=s}),R=o(function(e,t){function n(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(M),n(g),n(v),n(_),n(D)});return function(e){return e&&e.__esModule?e.default:e}(R)});
